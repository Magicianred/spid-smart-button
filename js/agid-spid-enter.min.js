window.AgidSpidEnter = function() {
    function getTpl(templateName, content) {
        return self.tpl[templateName].call(self, content);
    }
    function closeInfoModal() {
        infoModal.style.display = "none", infoModal.innerHTML = "", spidPanelSelect.focus();
    }
    function openInfoModal(htmlContent) {
        infoModal.innerHTML = getTpl("infoModal", htmlContent), infoModal.style.display = "block", 
        infoModal.focus(), document.querySelector("#closemodalbutton").addEventListener("click", closeInfoModal);
    }
    function shuffleIdp() {
        var i, ul = document.querySelector("#agid-spid-idp-list");
        for (i = ul.children.length; i >= 0; i--) ul.appendChild(ul.children[Math.random() * i | 0]);
    }
    function animate_element_in(elementId) {
        var element = document.getElementById(elementId);
        element.style.display = "block", element.classList.remove(elementId + "-anim-in"), 
        element.classList.remove(elementId + "-anim-out"), element.classList.add(elementId + "-anim-in");
    }
    function animate_element_out(elementId) {
        var element = document.getElementById(elementId);
        element.classList.remove(elementId + "-anim-in"), element.classList.remove(elementId + "-anim-out"), 
        element.classList.add(elementId + "-anim-out");
    }
    function showProvidersPanel() {
        var hiddenattribute, toshow = spidPanelSelect, base = document.querySelector("#agid-spid-button-anim-base"), panel = document.querySelector("#agid-spid-button-anim"), buttons = document.querySelector(".agid-spid-enter-button");
        shuffleIdp(), toshow.removeAttribute("hidden"), toshow.style.display = "block", 
        Array.from(buttons).forEach(function(button) {
            hiddenattribute = document.createAttribute("hidden"), button.style.display = "none", 
            button.setAttributeNode(hiddenattribute);
        }), animate_element_in("agid-spid-button-anim"), animate_element_in("agid-spid-button-anim-base"), 
        animate_element_in("agid-spid-button-anim-icon"), animate_element_in("agid-spid-panel-select"), 
        base.addEventListener("animationstart", function() {
            panel.style.display = "block", base.style.display = "block";
        }, !0), base.addEventListener("animationend", function() {
            panel.style.display = "block", base.style.display = "block", toshow.focus();
        }, !0);
    }
    function hideProvidersPanel() {
        var toHide = spidPanelSelect, base = document.querySelector("#agid-spid-button-anim-base"), panel = document.querySelector("#agid-spid-button-anim"), buttons = document.querySelector(".agid-spid-enter-button"), hiddenattribute = document.createAttribute("hidden");
        toHide.setAttributeNode(hiddenattribute), toHide.style.display = "none", Array.from(buttons).forEach(function(button) {
            button.style.display = "block", button.removeAttribute("hidden");
        }), animate_element_out("agid-spid-button-anim"), animate_element_out("agid-spid-button-anim-base"), 
        animate_element_out("agid-spid-button-anim-icon"), animate_element_out("agid-spid-panel-select"), 
        base.addEventListener("animationstart", function() {
            panel.style.display = "block", base.style.display = "block";
        }, !0), base.addEventListener("animationend", function() {
            var newone;
            panel.style.display = "none", base.style.display = "none", newone = base.cloneNode(!0), 
            base.parentNode.replaceChild(newone, base);
        }, !0);
    }
    function renderAvailableProviders(data) {
        var provider, providerData, agid_spid_enter = document.querySelector("#agid-spid-enter"), spidProvidersButtonsHTML = "";
        for (provider in data.spidProviders) {
            if (!(providerData = data.spidProviders[provider]).url) return;
            spidProvidersButtonsHTML += getTpl("spidProviderButton", providerData);
        }
        agid_spid_enter.innerHTML = getTpl("spidProviderChoiceModal", spidProvidersButtonsHTML), 
        hasSpidProviders = !0, document.querySelector("#agid-spid-panel-close-button").addEventListener("click", hideProvidersPanel), 
        document.querySelector("#agid-spid-cancel-access-button").addEventListener("click", hideProvidersPanel), 
        document.querySelector("#nospid").addEventListener("click", function() {
            openInfoModal(getTpl("nonHaiSpid"));
        }), document.querySelector("#cosaspid").addEventListener("click", function() {
            openInfoModal(getTpl("cosaSpid"));
        });
    }
    function getSpidButtonsPlaceholders() {
        var spidButtonsPlaceholdersObj = document.querySelectorAll(".agid-spid-enter-button");
        return Array.from(spidButtonsPlaceholdersObj);
    }
    function renderSpidButtons() {
        var spidButtonsPlaceholders = getSpidButtonsPlaceholders(), hasButtonsOnPage = spidButtonsPlaceholders.length;
        hasSpidProviders ? hasButtonsOnPage ? (spidButtonsPlaceholders.forEach(function(spidButton) {
            var foundDataSize = spidButton.getAttribute("data-size"), dataSize = foundDataSize.toLowerCase(), supportedSizes = [ "s", "m", "l", "xl" ];
            -1 !== supportedSizes.indexOf(dataSize) ? spidButton.innerHTML = getTpl("spidButton", dataSize) : console.error("Le dimenioni supportate sono", supportedSizes, "trovato invece:", foundDataSize, spidButton);
        }), Array.from(document.querySelectorAll(".agid-spid-enter")).forEach(function(spidButton) {
            spidButton.addEventListener("click", showProvidersPanel);
        })) : console.warn("Nessun placeholder HTML trovato nella pagina per i pulsanti SPID") : console.error("Si è verificato un errore nel caricamento dei providers, impossibile renderizzare i pulsanti SPID");
    }
    function ajaxRequest(method, url) {
        return new Promise(function(resolve, reject) {
            var xhr = new XMLHttpRequest();
            xhr.open(method, url), xhr.onreadystatechange = function() {
                4 === xhr.readyState && (200 === xhr.status && xhr.responseText ? resolve(JSON.parse(xhr.responseText)) : reject(xhr.responseText));
            }.bind(this), xhr.send();
        });
    }
    function getLocalisedMessages() {
        return ajaxRequest("GET", self.config.localisationEndpoint);
    }
    function getAvailableProviders() {
        return ajaxRequest("GET", self.config.providersEndpoint);
    }
    function isElementVisible(element) {
        return "none" !== element.style.display;
    }
    function renderSpidModalContainer() {
        var agidSpidEnterWrapper = document.createElement("SECTION");
        agidSpidEnterWrapper.id = "agid-spid-enter-container", document.body.insertBefore(agidSpidEnterWrapper, document.body.firstChild), 
        agidSpidEnterWrapper.innerHTML = getTpl("spidMainContainers");
    }
    function bindEscKeyEvent() {
        document.addEventListener("keyup", function(event) {
            var isEscKeyHit = 27 === event.keyCode, isInfoModalVisible = isElementVisible(infoModal), isProvidersPanelVisible = isElementVisible(spidPanelSelect);
            isEscKeyHit && (isInfoModalVisible ? closeInfoModal() : isProvidersPanelVisible && hideProvidersPanel());
        });
    }
    function getSelectors() {
        infoModal = document.querySelector("#agid-infomodal"), spidPanelSelect = document.querySelector("#agid-spid-panel-select");
    }
    var infoModal, spidPanelSelect, self = this, hasSpidProviders = !1;
    return {
        init: function() {
            var fetchData = [ getLocalisedMessages(), getAvailableProviders() ];
            Promise.all(fetchData).then(function(data) {
                self.i18n = data[0], renderSpidModalContainer(), renderAvailableProviders(data[1]), 
                renderSpidButtons(), getSelectors(), bindEscKeyEvent();
            }).catch(function(error) {
                console.error("Si è verificato un errore nel caricamento dei dati", error);
            });
        },
        updateSpidButtons: renderSpidButtons
    };
}, window.AgidSpidEnter.prototype.tpl = {
    spidMainContainers: function() {
        return [ '<link rel="stylesheet" href="css/agid-spid-enter.min.css">', '<div id="agid-spid-enter"></div>', '<div id="agid-infomodal" class="modal" aria-live="assertive" hidden></div>' ].join("");
    },
    spidProviderChoiceModal: function(spidProvidersButtons) {
        return [ '<div id="agid-spid-button-anim">', '<div id="agid-spid-button-anim-base"></div>', '<div id="agid-spid-button-anim-icon"></div>', "</div>", '<section id="agid-spid-panel-select" class="agid-spid-panel" aria-modal="true" aria-labelledby="agid-spid-enter-title-page" tabindex="-1" hidden>', '<header id="agid-spid-panel-header">', '<nav class="agid-spid-panel-back agid-spid-panel-element" aria-controls="agid-spid-panel-select">', '<div role="button" tabindex="0">', '<a id="agid-spid-panel-close-button" href="#" class="agid-spid-button">', '<img src="img/x-icon.svg" alt="', this.getI18n("naviga_indietro"), '">', "</a>", "</div>", "</nav>", '<div class="agid-spid-panel-logo agid-spid-panel-element">', '<img aria-hidden="true" src="img/spid-logo-c-lb.svg" alt="', this.getI18n("alt_logo_SPID"), '">', "</div>", "</header>", '<div id="agid-spid-panel-content">', '<div class="agid-spid-panel-content-center">', '<div id ="agid-spid-enter-title-container">', '<h1 id="agid-spid-enter-title-page">', this.getI18n("scegli_provider_SPID"), "</h1>", "</div>", '<div id="agid-spid-idp-list" class="agid-spid-row">', spidProvidersButtons, "</div>", '<div id="agid-cancel-access-container">', '<a id="agid-spid-cancel-access-button" href="#" role="button">', '<div id="agid-cancel-access-button" class="agid-transparent-button">', "<span>", this.getI18n("annulla_accesso"), "</span>", "</div>", "</a>", "</div>", '<div id="agid-logo-container" aria-hidden="true">', '<img id="agid-logo" class="agid-logo" src="./img/agid-logo-bb-short.png" aria-hidden="true" />', "</div>", "</div>", "</div>", '<footer id="agid-spid-panel-footer">', '<div id="agid-action-button-container">', '<a id="nospid" href="#" role="button">', '<div class="agid-action-button">', "<span>", this.getI18n("non_hai_SPID"), "</span>", "</div>", "</a>", '<a id="cosaspid" href="#" role="button">', '<div class="agid-action-button">', "<span>", this.getI18n("cosa_SPID"), "</span>", "</div>", "</a>", "</div>", "</footer>", "</section>" ].join("");
    },
    spidProviderButton: function(providerData) {
        return [ '<span class="agid-spid-col l3 m6 s6 xs12" role="button">', '<a href="', providerData.url, '"', 'class="agid-spid-idp-button agid-spid-idp-infocertid"', 'title="', providerData.title, '"', 'style="background-image: url(img/idp-logos/', providerData.logo, ')">', "</a>", "</span>" ].join("");
    },
    spidButton: function(sizeClass) {
        return [ "\x3c!-- AGID - SPID BUTTON ", sizeClass.toUpperCase(), " * begin * --\x3e", '<button class="agid-spid-enter agid-spid-enter-size-', sizeClass, '" style="display:none">', '<span aria-hidden="true" class="agid-spid-enter-icon">', '<img aria-hidden="true" src="img/spid-ico-circle-bb.svg" onerror="this.src=\'img/spid-ico-circle-bb.png\'; this.onerror=null;" alt="', this.getI18n("entra_con_SPID"), '" />', "</span>", '<span class="agid-spid-enter-text">', this.getI18n("entra_con_SPID"), "</span>", "</button>", "\x3c!-- AGID - SPID BUTTON ", sizeClass.toUpperCase(), " * end * --\x3e" ].join("");
    },
    infoModal: function(htmlContent) {
        return [ '<div class="modal-content">', '<span id="closemodalbutton" class="close" role="button" tabindex="0" aria-label="', this.getI18n("aria_chiudi_modale"), '"><b aria-hidden="true">&times;</b></span>', "<div>", htmlContent, "</div>", "</div>" ].join("");
    },
    nonHaiSpid: function() {
        return [ "<ul>", "<li>Morbi in sem quis dui placerat ornare. Pellentesque odio nisi, euismod in, pharetra a, ultricies in, diam. Sed arcu. Cras consequat.</li>", "<li>Praesent dapibus, neque id cursus faucibus, tortor neque egestas augue, eu vulputate magna eros eu erat. Aliquam erat volutpat. Nam dui mi, tincidunt quis, accumsan porttitor, facilisis luctus, metus.</li>", "<li>Phasellus ultrices nulla quis nibh. Quisque a lectus. Donec consectetuer ligula vulputate sem tristique cursus. Nam nulla quam, gravida non, commodo a, sodales sit amet, nisi.</li>", "<li>Pellentesque fermentum dolor. Aliquam quam lectus, facilisis auctor, ultrices ut, elementum vulputate, nunc.</li>", "</ul>" ].join("");
    },
    cosaSpid: function() {
        return [ "<h1>HTML Ipsum Presents</h1>", '<p><strong>Pellentesque habitant morbi tristique</strong> senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. <em>Aenean ultricies mi vitae est.</em> Mauris placerat eleifend leo. Quisque sit amet est et sapien ullamcorper pharetra. Vestibulum erat wisi, condimentum sed, <code>commodo vitae</code>, ornare sit amet, wisi. Aenean fermentum, elit eget tincidunt condimentum, eros ipsum rutrum orci, sagittis tempus lacus enim ac dui. <a href="#">Donec non enim</a> in turpis pulvinar facilisis. Ut felis.</p>', "<h2>Header Level 2</h2>", "<ol>", "<li>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</li>", "<li>Aliquam tincidunt mauris eu risus.</li>", "</ol>", "<blockquote><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus magna. Cras in mi at felis aliquet congue. Ut a est eget ligula molestie gravida. Curabitur massa. Donec eleifend, libero at sagittis mollis, tellus est malesuada tellus, at luctus turpis elit sit amet quam. Vivamus pretium ornare est.</p></blockquote>", "<h3>Header Level 3</h3>", "<ul>", "<li>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</li>", "<li>Aliquam tincidunt mauris eu risus.</li>", "</ul>" ].join("");
    }
}, window.AgidSpidEnter.prototype.i18n = {}, window.AgidSpidEnter.prototype.getI18n = function(labelKey) {
    var locale = document.getElementsByTagName("html")[0].getAttribute("lang") || this.i18n["spid-texts"].default, copy = this.i18n.language && this.i18n.language[locale] && this.i18n.language[locale][labelKey];
    return this.i18n.language[locale] ? this.i18n.language[locale][labelKey] || console.error("La chiave richiesta non è disponibile nel locale selezionato:", labelKey) : console.error("Il locale richiesto non è disponibile:", locale), 
    copy || labelKey;
}, window.AgidSpidEnter.prototype.config = {
    providersEndpoint: "/src/data/spidProviders-success.json",
    localisationEndpoint: "/src/data/spidI18n.json"
}, window.agidSpidEnter = new window.AgidSpidEnter();