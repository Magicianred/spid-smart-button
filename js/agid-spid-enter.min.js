var config = {
    aruba: {
        url: "#http://aruba",
        title: "Accedi a SPID con Aruba",
        logo: "spid-idp-aruba.svg"
    },
    infocert: {
        url: "#http://infocert",
        title: "Accedi a SPID con Infocert",
        logo: "spid-idp-infocertid.svg"
    },
    poste: {
        url: "#http://poste",
        title: "Accedi a SPID con Poste",
        logo: "spid-idp-posteid.svg"
    },
    sielte: {
        url: "#http://sielte",
        title: "Accedi a SPID con Sielte",
        logo: "spid-idp-sielteid.svg"
    },
    tim: {
        url: "#http://tim",
        title: "Accedi a SPID con Tim",
        logo: "spid-idp-timid.svg"
    },
    newidp1: {
        url: "#1",
        title: "Fornitore non attivo",
        logo: "spid-idp-dummy.svg"
    },
    newidp2: {
        url: "#2",
        title: "Fornitore non attivo",
        logo: "spid-idp-dummy.svg"
    },
    newidp3: {
        url: "#3",
        title: "Fornitore non attivo",
        logo: "spid-idp-dummy.svg"
    }
};

window.agidSpidEnterTpl = {
    spidMainContainers: function() {
        return [ '<link rel="stylesheet" href="css/agid-spid-enter.min.css">', '<div id="infomodal" class="modal"></div>', '<div id="agid-spid-enter"></div>' ].join("");
    },
    spidProviderChoiceModal: function(spidProvidersButtons) {
        return [ '<div id="agid-spid-button-anim">', '<div id="agid-spid-button-anim-base"></div>', '<div id="agid-spid-button-anim-icon"></div>', "</div>", '<section id="agid-spid-panel-select" class="agid-spid-panel" aria-labelledby="agid-spid-enter-title-page" hidden>', '<header id="agid-spid-panel-header">', '<nav class="agid-spid-panel-back agid-spid-panel-element" aria-controls="agid-spid-panel-select">', '<div role="button">', '<a id="agid-spid-panel-close-button" href="#" class="agid-spid-button">', '<img src="img/x-icon.svg" alt="Torna indietro">', "</a>", "</div>", "</nav>", '<div class="agid-spid-panel-logo agid-spid-panel-element">', '<img aria-hidden="true" src="img/spid-logo-c-lb.svg" alt="Logo SPID">', "</div>", "</header>", '<div id="agid-spid-panel-content">', '<div class="agid-spid-panel-content-center">', '<div id ="agid-spid-enter-title-container">', '<h1 id="agid-spid-enter-title-page">Scegli il tuo provider SPID</h1>', "</div>", '<div id="agid-spid-idp-list" class="agid-spid-row">', spidProvidersButtons, "</div>", '<div id="agid-cancel-access-container">', '<a id="agid-spid-cancel-access-button" href="#">', '<div id="agid-cancel-access-button" class="agid-transparent-button" role="button">', "<span>Annulla l'accesso</span>", "</div>", "</a>", "</div>", '<div id="agid-logo-container" aria-hidden="true">', '<img id="agid-logo" class="agid-logo" src="./img/agid-logo-bb-short.png" aria-hidden="true" />', "</div>", "</div>", "</div>", '<footer id="agid-spid-panel-footer">', '<div id="agid-action-button-container">', '<a href="#">', '<div id="nospid" class="agid-action-button" role="button">', "<span>Non hai SPID?</span>", "</div>", "</a>", '<a href="#">', '<div id="cosaspid" class="agid-action-button" role="button">', "<span>Cos'e SPID?</span>", "</div>", "</a>", "</div>", "</footer>", "</section>" ].join("");
    },
    spidProviderButton: function(providerData) {
        return [ '<span class="agid-spid-col l3 m6 s6 xs12" role="button">', '<a href="', providerData.url, '"', 'class="agid-spid-idp-button agid-spid-idp-infocertid"', 'title="', providerData.title, '"', 'style="background-image: url(img/idp-logos/', providerData.logo, ')">', "</a>", "</span>" ].join("");
    },
    spidButton: function(sizeClass) {
        return [ "\x3c!-- AGID - SPID BUTTON ", sizeClass.toUpperCase(), " * begin * --\x3e", '<button class="agid-spid-enter agid-spid-enter-size-', sizeClass, '" style="display:none">', '<span aria-hidden="true" class="agid-spid-enter-icon">', '<img aria-hidden="true" src="img/spid-ico-circle-bb.svg" onerror="this.src=\'img/spid-ico-circle-bb.png\'; this.onerror=null;" alt="Entra con SPID" />', "</span>", '<span class="agid-spid-enter-text">Entra con SPID</span>', "</button>", "\x3c!-- AGID - SPID BUTTON ", sizeClass.toUpperCase(), " * end * --\x3e" ].join("");
    },
    modalCloseButton: function(text) {
        return [ '<div class="modal-content">', '<span id="closemodalbutton" class="close" >&times;</span>', "<p>", text, "</p>", "</div>" ].join("");
    }
}, window.agidSpidEnter = function() {
    function renderConfiguredProviders() {
        var agid_spid_enter = document.querySelector("#agid-spid-enter"), spidProvidersButtonsHTML = "";
        for (var provider in config) {
            var providerData = config[provider];
            if (!providerData.url) return;
            spidProvidersButtonsHTML += agidSpidEnterTpl.spidProviderButton(providerData);
        }
        agid_spid_enter.innerHTML = agidSpidEnterTpl.spidProviderChoiceModal(spidProvidersButtonsHTML), 
        document.querySelector("#agid-spid-panel-close-button").addEventListener("click", function() {
            hideProvidersPanel();
        }), document.querySelector("#agid-spid-cancel-access-button").addEventListener("click", function() {
            hideProvidersPanel();
        }), document.querySelector("#nospid").addEventListener("click", function() {
            openModal("Non hai SPID?");
        }), document.querySelector("#cosaspid").addEventListener("click", function() {
            openModal("Cos'Ã¨ SPID?");
        });
    }
    function renderSpidButtons() {
        var agid_spid_enter_buttons = document.querySelectorAll(".agid-spid-enter-button");
        Array.from(agid_spid_enter_buttons).forEach(function(spidButton) {
            var foundDataSize = spidButton.getAttribute("data-size"), dataSize = foundDataSize.toLowerCase(), supportedSizes = [ "s", "m", "l", "xl" ];
            -1 != supportedSizes.indexOf(dataSize) ? spidButton.innerHTML = agidSpidEnterTpl.spidButton(dataSize) : console.error("Le dimenioni supportate sono", supportedSizes, "trovato invece:", foundDataSize, spidButton);
        }), Array.from(document.querySelectorAll(".agid-spid-enter")).forEach(function(spidButton) {
            spidButton.addEventListener("click", function() {
                showProvidersPanel();
            });
        });
    }
    function animate_element_in(e) {
        var element = document.getElementById(e);
        element.style.display = "block", element.classList.remove(e + "-anim-in"), element.classList.remove(e + "-anim-out"), 
        element.classList.add(e + "-anim-in");
    }
    function animate_element_out(e) {
        var element = document.getElementById(e);
        element.classList.remove(e + "-anim-in"), element.classList.remove(e + "-anim-out"), 
        element.classList.add(e + "-anim-out");
    }
    function showProvidersPanel(name) {
        var hiddenattribute, toshow = document.querySelector("#agid-spid-panel-select"), base = document.querySelector("#agid-spid-button-anim-base"), panel = document.querySelector("#agid-spid-button-anim"), buttons = document.querySelector(".agid-spid-enter-button");
        shuffleIdp(), toshow.removeAttribute("hidden"), toshow.style.display = "block", 
        Array.from(buttons).forEach(function(button) {
            hiddenattribute = document.createAttribute("hidden"), button.style.display = "none", 
            button.setAttributeNode(hiddenattribute);
        }), animate_element_in("agid-spid-button-anim"), animate_element_in("agid-spid-button-anim-base"), 
        animate_element_in("agid-spid-button-anim-icon"), animate_element_in("agid-spid-panel-select"), 
        base.addEventListener("animationstart", function() {
            panel.style.display = "block", base.style.display = "block";
        }, !0), base.addEventListener("animationend", function() {
            panel.style.display = "block", base.style.display = "block";
        }, !0);
    }
    function hideProvidersPanel(name) {
        var tohide = document.querySelector("#agid-spid-panel-select"), base = document.querySelector("#agid-spid-button-anim-base"), panel = document.querySelector("#agid-spid-button-anim"), buttons = document.querySelector(".agid-spid-enter-button"), hiddenattribute = document.createAttribute("hidden");
        tohide.setAttributeNode(hiddenattribute), tohide.style.display = "none", Array.from(buttons).forEach(function(button) {
            button.style.display = "block", button.removeAttribute("hidden");
        }), animate_element_out("agid-spid-button-anim"), animate_element_out("agid-spid-button-anim-base"), 
        animate_element_out("agid-spid-button-anim-icon"), animate_element_out("agid-spid-panel-select"), 
        base.addEventListener("animationstart", function() {
            panel.style.display = "block", base.style.display = "block";
        }, !0), base.addEventListener("animationend", function() {
            var newone;
            panel.style.display = "none", base.style.display = "none", newone = base.cloneNode(!0), 
            base.parentNode.replaceChild(newone, base);
        }, !0);
    }
    function shuffleIdp() {
        for (var ul = document.querySelector("#agid-spid-idp-list"), i = ul.children.length; i >= 0; i--) ul.appendChild(ul.children[Math.random() * i | 0]);
    }
    function renderSpidModalContainer() {
        var agidSpidEnterWrapper = document.createElement("SECTION");
        agidSpidEnterWrapper.id = "agid-spid-enter-container", document.body.insertBefore(agidSpidEnterWrapper, document.body.firstChild), 
        agidSpidEnterWrapper.innerHTML = agidSpidEnterTpl.spidMainContainers();
    }
    function openModal(text) {
        var modal = document.querySelector("#infomodal");
        modal.innerHTML = agidSpidEnterTpl.modalCloseButton(text), modal.style.display = "block", 
        document.getElementById("closemodalbutton").addEventListener("click", function() {
            closeModal();
        });
    }
    function closeModal() {
        var modal = document.querySelector("#infomodal");
        modal.style.display = "none", modal.innerHTML = "";
    }
    return renderSpidModalContainer(), renderConfiguredProviders(), renderSpidButtons(), 
    document.addEventListener("keyup", function(e) {
        27 == e.keyCode && hideProvidersPanel();
    }), {
        updateSpidButtons: renderSpidButtons
    };
}();